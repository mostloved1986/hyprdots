#!/bin/bash
source ~/.config/hypr/scripts/globalcontrol.sh
ScrDir="$HOME/.config/hypr/scripts"
ScriptDir="$CloneDir/Scripts"
#func="${1}"
cd $ScriptDir && echo "Hyprdots: $(git describe)" || exit 1

# Check for updates every 12 Hrs
[ ! -f "/tmp/hyprdots_update_check" ] || [[ $(find "/tmp/hyprdots_update_check" -mmin +720) ]] && \
( echo "CloneDirectory: $CloneDir" && \
git fetch > /dev/null 2>&1 && \
( [ "$(git rev-parse HEAD)" != "$(git rev-parse @{u})" ] && echo -e "Updates available! \nRUN: \033[0;34mHyprdots update\033[0m"  || echo -e "\033[0;32mHyprdots Up to date\033[0m" ) && \
touch "/tmp/hyprdots_update_check" )

params() {
func="${1}"
if awk "/^$func\(\) \{/,/}/" $0 | grep > /dev/null  'case'; then
  awk "/^$func\(\) \{/,/}/" $0 | grep -E '^\s+\w+\)' | awk 'BEGIN { FS = "[()#?]" } { sub(/^[ \t]+/, "", $1); printf "                          %-15s %s\n","["$1"]", $4 }'
fi

}

man() { #? Show Manual 
  echo "Usage: Hyprdots [function] [parameters]"
  echo ""
  grep -E '^\w+\(\) \{ #\?' $0 | while read -r line; do
    func=$(echo "$line" | awk 'BEGIN { FS = "[()#?]" } { print $1 }')
    desc=$(echo "$line" | awk 'BEGIN { FS = "[()#?]" } { print $5 }')
printf "  %-20s %s\n" "[$func]" "*$desc"
      params "$func"
       done
}


ConfigCtl() {
    FILE="$1"
    $(which code) -n "$FILE" &  # Start VS Code in the background

    # Wait for the file to be modified
    while inotifywait -e modify "$FILE" || read && exit 0; do
        echo "File has changed."
        ${ScrDir}/swwwallbash.sh "$getWall"
    done

    echo "Press Enter when you're done editing..."
    read  # Wait for the user to press Enter

    exit 0
}








restore() { #? Restore Hyprdots Conigurations
./install.sh  -r
  }

update() { #? Pull Updates From Hyprdots Repository 
git stash > /dev/null ; git pull ; git stash pop 2> /dev/null 
rm -f "/tmp/hyprdots_update_check"
  }

install() { #? Fresh install your config also installs apps. 
./install.sh
  }

theme() { #? Theme Related Actions
  # Function for managing themes
case $1 in 
        set) #? Set Theme
            $ScrDir/themeswitch.sh -s
        ;;
        next) #? Next Theme
            $ScrDir/themeswitch.sh -n
        ;; 
        prev) #? Previous Theme
            $ScrDir/themeswitch.sh -p
        ;;
        select) #? Theme Selector
            $ScrDir/themeselect.sh
        ;;
        patch) #? Patch A Theme from different repository.
            shift
            cd $ScriptDir
            ./themepatcher.sh "$@"
        ;;
        *)
         echo "$(params "${func}" )"
        ;;
esac
}

wallpaper() { #? Wallpaper related Actions
echo $1
echo $func
  case $1 in 
        set) #? Set /Path/to/Wallpaper as Wallpaper
            shift
            if [ -z "$@" ]; then echo "Missing: /Path/to/Wallpaper" ; exit 1 ; fi
            $ScrDir/swwwallpaper.sh -s "$@"
        ;;
        next) #? Next Wallppaer
            $ScrDir/swwwallpaper.sh -n 
        ;;
        prev) #? Previous Wallpaper
            $ScrDir/sswwwallpaper.sh -p
        ;;
        select) #? Wallpaper Selector
            $ScrDir/swwwallselect.sh
        ;;
        *)
         echo "$(params "${func}" )"
        ;;
esac
}

sddm() { #? Sddm Things
  # Function for managing SDDM settings
  echo "Setting SDDM with parameters: $@"
  case $1 in 
        set) #? Set active Wallpaper to Sddm Lockscreen
            $ScrDir/sddmwall.sh
        ;;
        *)
         echo "$(params "${func}" )"
        ;;
esac
}
wallbash(){ #? Wallbash
  case $1 in 
        toggle) #? Toggle Wall bash On/Off
            $ScrDir/wallbashtoggle.sh
        ;;
        *)
         echo "$(params "${func}" )"
        ;;
esac
}


waybar() { #? Waybar related Things
    case $1 in
        config) #? Edit waybar Control File.
            ConfigCtl "$HOME/.config/waybar/config.ctl"
            ;;
        *)
            echo "$(params "${func}" )"
            ;;
    esac
}



code() {

case $1 in 
         select) #? Selector for default Theme preset
         ;;
        *)
         echo "$(params "${func}" )"
        ;;
esac
}

cache() { #? Run Caching
        if [[ -z $1 ]]; then
        ./create_cache.sh 
        else
case $1 in 
      reset) #? Force remove cache
            ./create_cache.sh -f
         ;;
        add) #! Cache custom /path/to/wallpaper/* ( Broken)
        if [[ -z $2 ]]; then
            echo "Please provide a /path/to/wallpaper/*." 
        else
            ./create_cache.sh -c "$2"
        fi
        ;;
        *)
         echo "$(params "${func}" )"
        ;;
esac
fi
}













if ! grep -q "$func()" $0 ; then   echo ""
   echo "Usage: Hyprdots [function]"
  echo ""
  grep -E '^\w+\(\) \{ #\?' $0 | awk 'BEGIN { FS = "[()#?]" } { printf "  %-20s %s\n", $1, $5 }'
 exit 1 
  fi

# Call the appropriate function based on the first argument
"$@"
